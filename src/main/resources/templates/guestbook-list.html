<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" th:inline="javascript">
<head>
  <meta charset="UTF-8">
  <title>Guestbook List</title>
  <style>
    table { width: 100%; border-collapse: collapse; }
    th, td { padding: 8px 12px; border: 1px solid #ccc; text-align: left; }
    th { background-color: #f4f4f4; }
  </style>
</head>
<body>
<h1>Guestbook List</h1>
<table>
  <thead>
  <tr>
    <th>ID</th>
    <th>Nickname</th>
    <th>Comment</th>
    <th>Like Count</th>
    <th>Displayed</th>
    <th>CreatedDate</th>
  </tr>
  </thead>
  <tbody>
  <tr th:each="guestbook : ${response.readGuestbookResponses}">
    <td th:text="${guestbook.id}">1</td>
    <td th:text="${guestbook.nickname}">Nickname</td>
    <td th:text="${guestbook.comment}">Comment</td>
    <td th:text="${guestbook.likeCount}">0</td>
    <td>
      <select th:id="'displaySelect-' + ${guestbook.id}"
              th:value="${guestbook.isDisplayed}"
              th:onchange="|updateDisplayFlag(${guestbook.id}, this.value)|">
        <option th:value="true" th:selected="${guestbook.isDisplayed}">Yes</option>
        <option th:value="false" th:selected="${!guestbook.isDisplayed}">No</option>
      </select>
    </td>
    <td th:text="${guestbook.createdDate}">2025-09-27 22:00</td>
  </tr>
  </tbody>
</table>

<script th:inline="javascript">
  function updateDisplayFlag(id, value) {
    console.log("Updating display flag for guestbook ID:", id, "Value:", value);
    fetch('/admin/guestbook/updateDisplay', {
      method: 'POST',
      headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
      body: 'guestbookId=' + id + '&displayFlag=' + value
    })
    .then(res => res.json())
    .then(data => {
      if(data.success) {
        alert('Guestbook ' + id + ' 표시 상태가 ' + (value === 'true' ? 'Yes' : 'No') + '로 변경되었습니다.');
      } else {
        alert('표시 상태 변경 실패');
      }
    })
    .catch(err => {
      console.error(err);
      alert('표시 상태 변경 중 오류 발생');
    });
  }
</script>
</body>
</html>
